#!/bin/sh

SYSTEMCTL_PY="systemctl3.py"
DIRNAME="${0%/*}"
SYSTEMCTL="$DIRNAME/$SYSTEMCTL_PY"
COMMAND="$SYSTEMCTL"

no_sudo_commands="-h --help --version version cat command default-services \
                   environment get-default get-preset help is-enabled \
                   list-dependencies list-start-dependencies list-unit-files \
                   listen log"

out() { printf "$1 $2\n" "${@:3}"; }
error() { out "==> ERROR:" "$@"; } >&2
warning() { out "==> WARNING:" "$@"; } >&2
msg() { out "==>" "$@"; }
die() { error "$@"; exit 1; }

ignore_error() {
  "$@" 2>/dev/null
  return 0
}

sudo_command(){
  if [ "$(id -u)" -ne 0 ] ; then
    if SUDO="$(which sudo)" ; then
      COMMAND="$SUDO $COMMAND"
    else
      die "Failed to ${@}: Interactive authentication required."
    fi
  fi
}

systemctl() {
  [ -z "$1" ] && sudo_command

  case " $no_sudo_commands " in
  *" $1 "*)
    ;;
  *)
    sudo_command
    ;;
  esac

  exec ${COMMAND} "$@"
}

systemctl ${@}